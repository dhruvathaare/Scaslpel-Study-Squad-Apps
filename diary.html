<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Scalpel Master Standard</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.1.0"></script>
    <style>
        :root { --bg: #0e1621; --card: #17212b; --text: #ffffff; --border: #2b5278; --accent: #5288c1; --input-bg: #0e1621; }
        html, body { height: 100%; margin: 0; padding: 0; background: var(--bg); color: var(--text); }
        body { display: flex; flex-direction: column; align-items: center; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 15px; box-sizing: border-box; overflow-y: auto; min-height: 100vh; }
        .container { width: 100%; max-width: 420px; display: flex; flex-direction: column; align-items: center; text-align: center; }
        .header-ui { width: 100%; display: flex; justify-content: flex-end; margin-bottom: 10px; }
        .user-badge { background: rgba(82, 136, 193, 0.2); border: 1px solid var(--accent); padding: 8px 12px; border-radius: 15px; font-size: 11px; color: var(--accent); font-weight: bold; text-align: right; line-height: 1.3; }
        .logo { width: 85px; height: 85px; border-radius: 50%; border: 4px solid var(--accent); margin-bottom: 10px; box-shadow: 0 0 15px rgba(82,136,193,0.3); }
        h1 { color: var(--accent); font-size: 22px; margin: 5px 0; font-weight: bold; text-transform: uppercase; }
        .exam-dashboard { background: rgba(82, 136, 193, 0.15); border: 1px solid var(--accent); padding: 12px; border-radius: 15px; width: 100%; margin-bottom: 15px; box-sizing: border-box; }
        .exam-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .exam-item { background: rgba(0,0,0,0.2); padding: 8px; border-radius: 10px; border: 1px solid rgba(82, 136, 193, 0.3); }
        .exam-days { font-size: 16px; font-weight: bold; color: var(--accent); display: block; }
        .exam-label { font-size: 8px; text-transform: uppercase; opacity: 0.9; letter-spacing: 0.5px; margin-top: 2px; display: block; }
        .streak-text { font-size: 18px; font-weight: bold; color: #f39c12; }
        .quote { font-family: 'Oswald', sans-serif; color: #ef5350; font-weight: 700; font-size: 11px; text-transform: uppercase; margin: 10px 0; line-height: 1.2; }
        .nav-tabs { display: flex; width: 100%; background: var(--card); border-radius: 12px; margin-bottom: 15px; border: 1px solid var(--border); overflow: hidden; }
        .tab-btn { flex: 1; padding: 12px 2px; font-size: 9px; font-weight: bold; cursor: pointer; border: none; background: none; color: white; opacity: 0.5; }
        .tab-btn.active { opacity: 1; background: var(--accent); }
        .tab-content { width: 100%; display: none; }
        .tab-content.active { display: block; }
        .card { background: var(--card); padding: 12px; border-radius: 20px; border: 1px solid var(--border); width: 100%; box-sizing: border-box; margin-bottom: 15px; }
        .setting-label { font-size: 9px; color: #888; text-transform: uppercase; margin: 6px 0 2px 0; display: block; font-weight: bold; text-align: left; }
        input, select { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid var(--border); background: var(--input-bg); color: var(--text); text-align: center; font-size: 13px; box-sizing: border-box; }
        #timer-display { font-size: 52px; font-weight: bold; margin: 5px 0; font-variant-numeric: tabular-nums; }
        .btn { background: #2481cc; color: white; border: none; padding: 15px; border-radius: 12px; font-weight: bold; width: 100%; cursor: pointer; font-size: 14px; margin-top: 10px; }
        .log-table { width: 100%; font-size: 10px; text-align: left; border-collapse: collapse; margin-top: 10px; table-layout: fixed; }
        .log-table th, .log-table td { padding: 8px 4px; border-bottom: 1px solid rgba(255,255,255,0.05); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .calc-preview { background: rgba(82, 136, 193, 0.1); padding: 8px; border-radius: 10px; margin-top: 8px; font-size: 11px; border: 1px dashed var(--accent); display: flex; justify-content: space-around; align-items: center; }
        .matrix-table { font-size: 8px; width: 100%; border-collapse: collapse; margin-top: 10px; color: #fff; }
        .matrix-table th, .matrix-table td { border: 1px solid var(--border); padding: 4px 2px; text-align: center; }
        #popup-overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.96); z-index:2000; justify-content:center; align-items:center; flex-direction: column;}
        .danger-zone { margin-top: 30px; padding: 15px; border-top: 1px dashed rgba(255,255,255,0.1); width: 100%; opacity: 0.6; }
        .clear-btn { background: none; border: 1px solid #ef5350; color: #ef5350; padding: 8px; border-radius: 8px; font-size: 10px; cursor: pointer; }
    </style>
</head>
<body>
    <div id="popup-overlay">
        <div class="card" style="max-width:320px; text-align:center;">
            <h3>Cycle Complete</h3>
            <input type="number" id="cycleMcqs" placeholder="MCQs solved">
            <button class="btn" onclick="startBreak()">Record & Start Break</button>
        </div>
    </div>

    <div class="container">
        <div class="header-ui">
            <div class="user-badge"><span id="uFullName">...</span><span id="uID" style="opacity:0.7; font-size:9px;">ID: 0</span></div>
        </div>
        <img src="https://github.com/dhruvathaare/Scaslpel-Study-Squad-Apps/blob/main/photo_2026-02-12_20-08-36.jpg?raw=true" class="logo">
        <h1>Scalpel Study Squad</h1>
        
        <div class="exam-dashboard">
            <div class="exam-grid">
                <div class="exam-item"><span id="daysIniJuly" class="exam-days">--</span><span class="exam-label">INICET JULY</span></div>
                <div class="exam-item"><span id="daysUpsc" class="exam-days">--</span><span class="exam-label">UPSC CMS</span></div>
                <div class="exam-item"><span id="daysNeet" class="exam-days">--</span><span class="exam-label">NEET PG 2026</span></div>
                <div class="exam-item"><span id="daysIniJan" class="exam-days">--</span><span class="exam-label">INICET JAN '27</span></div>
            </div>
        </div>

        <div class="streak-section">
            <div id="streakText" class="streak-text">Consistency: 0 Days</div>
            <div id="streakIcons" style="font-size:24px;"></div>
        </div>
        <div class="quote">"I AM HERE TO WIN, CONSISTENCY IS MY KITH AND KIN"</div>

        <div class="nav-tabs">
            <div class="tab-btn active" onclick="switchTab('tab-goal', this)">Goal</div>
            <div class="tab-btn" onclick="switchTab('tab-daily', this)">Daily Tracker</div>
            <div class="tab-btn" onclick="switchTab('tab-swt', this)">SWT Analysis</div>
            <div class="tab-btn" onclick="switchTab('tab-gt', this)">GT Analysis</div>
        </div>

        <div id="tab-goal" class="tab-content active">
            <div class="card">
                <span class="setting-label">Target Exams (Permanent)</span>
                <div id="targetList" style="display:grid;grid-template-columns:1fr 1fr;gap:5px;font-size:10px;text-align:left;">
                    <label><input type="checkbox" onchange="saveTarg()" value="NEET"> NEET PG</label>
                    <label><input type="checkbox" onchange="saveTarg()" value="INI_J"> INI JULY</label>
                    <label><input type="checkbox" onchange="saveTarg()" value="UPSC"> UPSC CMS</label>
                    <label><input type="checkbox" onchange="saveTarg()" value="INI_N"> INI JAN</label>
                </div>
            </div>
            <div class="card">
                <h3>Reading Phases</h3>
                <div id="phaseInputs"></div>
            </div>
            <div class="card">
                <h3>Medals & Checklist</h3>
                <div id="medals" style="font-size:28px; margin-bottom:10px;"></div>
                <div id="subjectChecks" style="display:grid;grid-template-columns:repeat(4,1fr);gap:5px;font-size:8px;"></div>
            </div>
        </div>

        <div id="tab-daily" class="tab-content">
            <div class="card">
                <span class="setting-label">Reading Phase</span>
                <select id="readingPhase">
                    <option>First Reading</option>
                    <option>Second Reading</option>
                    <option>Third Reading</option>
                    <option>Extra Bonus Reading</option>
                </select>
                <span class="setting-label">Subject</span>
                <select id="subject" style="margin-top:5px;">
                    <option value="" disabled selected>Select Subject</option>
                    <option>Anatomy</option><option>Physiology</option><option>Biochemistry</option>
                    <option>Pathology</option><option>Microbiology</option><option>Pharmacology</option>
                    <option>FMT</option><option>PSM</option><option>Ophthalmology</option><option>ENT</option>
                    <option>Medicine</option><option>Surgery</option><option>OBG</option><option>Pediatrics</option>
                    <option>Anaesthesia</option><option>Dermatology</option><option>Orthopedics</option>
                    <option>Psychiatry</option><option>Radiology</option>
                </select>
                <div style="display:flex; gap:10px; margin-top:8px;">
                    <div style="flex:1;"><input type="number" id="studyHr" value="2"></div>
                    <div style="flex:1;"><input type="number" id="studyMin" value="0"></div>
                </div>
                <div id="timer-display">00:00:00</div>
                <button id="startBtn" class="btn" style="width:100%;">Start Session</button>
            </div>
            <div class="card">
                <h3>Analytics</h3>
                <div class="chart-container"><canvas id="hoursChart"></canvas></div>
                <div class="chart-container"><canvas id="mcqChart"></canvas></div>
                <div style="overflow-x:auto;"><table class="matrix-table" id="matrixTable"></table></div>
                <table class="log-table"><thead><tr><th>Date</th><th>Hrs</th><th>MCQ</th><th>Sub</th></tr></thead><tbody id="dailyLogBody"></tbody></table>
            </div>
        </div>

        <div id="tab-swt" class="tab-content">
            <div class="card">
                <h3>SWT Analysis</h3>
                <select id="swtSubject" onchange="renderSWT()"><option>Anatomy</option><option>Physiology</option><option>Biochemistry</option><option>Pathology</option><option>Microbiology</option><option>Pharmacology</option><option>FMT</option><option>PSM</option><option>Ophthalmology</option><option>ENT</option><option>Medicine</option><option>Surgery</option><option>OBG</option><option>Pediatrics</option><option>Anaesthesia</option><option>Dermatology</option><option>Orthopedics</option><option>Psychiatry</option><option>Radiology</option></select>
                <input type="date" id="swtDate" style="margin-top:5px;">
                <div style="display:flex; gap:5px; margin-top:5px;">
                    <input type="number" id="swtTotal" placeholder="Total" oninput="calcSWT()">
                    <input type="number" id="swtCorrect" placeholder="Correct" oninput="calcSWT()">
                    <input type="number" id="swtUnat" placeholder="Unat" oninput="calcSWT()">
                </div>
                <div class="calc-preview">Wrong: <b id="swtW">0</b> | Acc: <b id="swtP">0%</b></div>
                <button class="btn" onclick="saveSWT()">Save Result</button>
                <div class="chart-container"><canvas id="swtChart"></canvas></div>
                <div id="swtAnalysis" style="font-size:10px; text-align:left;"></div>
            </div>
        </div>

        <div id="tab-gt" class="tab-content">
            <div class="card">
                <h3>GT Intelligence</h3>
                <div style="display:flex; margin-bottom:10px;">
                    <div class="tab-btn active" id="tabNeet" style="flex:1;" onclick="switchGT('NEET')">NEET (+4/-1)</div>
                    <div class="tab-btn" id="tabInicet" style="flex:1;" onclick="switchGT('INICET')">INICET (+1/-0.33)</div>
                </div>
                <input type="date" id="gtDate">
                <div style="display:flex; gap:5px; margin-top:5px;">
                    <input type="number" id="gtCorrect" placeholder="Correct" oninput="calcGT()">
                    <input type="number" id="gtUnat" placeholder="Unat" oninput="calcGT()">
                </div>
                <div class="calc-preview">Wrong: <b id="gtW">0</b> | Score: <b id="gtS">0</b></div>
                <button class="btn" onclick="saveGT()">Save GT Result</button>
                <div id="neet-area"><div class="chart-container"><canvas id="gtNeetChart"></canvas></div><div id="gtNeetAnalysis"></div></div>
                <div id="inicet-area" style="display:none;"><div class="chart-container"><canvas id="gtInicetChart"></canvas></div><div id="gtInicetAnalysis"></div></div>
            </div>
        </div>

        <div class="danger-zone"><button class="clear-btn" onclick="clearData()">Clear All Local Data</button></div>
    </div>

    <script>
        const tg = window.Telegram.WebApp; tg.expand();
        const tgUser = tg.initDataUnsafe?.user || { id: "OFFLINE", first_name: "User" };
        const prefix = `SSS_PRO_FINAL_${tgUser.id}_`;
        const SUBJECTS = ["Anatomy", "Physiology", "Biochemistry", "Pathology", "Microbiology", "Pharmacology", "FMT", "PSM", "Ophthalmology", "ENT", "Medicine", "Surgery", "OBG", "Pediatrics", "Anaesthesia", "Dermatology", "Orthopedics", "Psychiatry", "Radiology"];
        const PHASES = ["First Reading", "Second Reading", "Third Reading", "Extra Bonus Reading"];

        let timerInterval, timeLeft = 0, isPaused = false, currentGTMode = "NEET";

        function saveTarg() { const sel = Array.from(document.querySelectorAll('#targetList input:checked')).map(i=>i.value); localStorage.setItem(prefix+'TARGETS', JSON.stringify(sel)); }
        function savePh(p, f, v) { let d = JSON.parse(localStorage.getItem(prefix+p)||'{}'); d[f]=v; localStorage.setItem(prefix+p, JSON.stringify(d)); updateUI(); }
        function togSub(p, s, v) { localStorage.setItem(prefix+p+s, v); updateUI(); }

        function switchTab(id, btn) { 
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            btn.classList.add('active'); document.getElementById(id).classList.add('active');
            updateUI();
        }

        document.getElementById('startBtn').onclick = () => {
            const sub = document.getElementById('subject').value;
            if(!sub) return tg.showAlert("Select Subject");
            timeLeft = (parseInt(document.getElementById('studyHr').value)*3600) + (parseInt(document.getElementById('studyMin').value)*60);
            document.getElementById('startBtn').style.display='none';
            runTimer();
        };

        function runTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if(!isPaused) {
                    timeLeft--;
                    let h=Math.floor(timeLeft/3600), m=Math.floor((timeLeft%3600)/60), s=timeLeft%60;
                    document.getElementById('timer-display').innerText = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
                    if(timeLeft <= 0) { clearInterval(timerInterval); document.getElementById('popup-overlay').style.display='flex'; }
                }
            }, 1000);
        }

        function startBreak() {
            const mcqs = parseInt(document.getElementById('cycleMcqs').value) || 0;
            const logs = JSON.parse(localStorage.getItem(prefix+'LOGS') || "[]");
            logs.unshift({
                date: new Date().toLocaleDateString('en-GB'),
                subject: document.getElementById('subject').value,
                phase: document.getElementById('readingPhase').value,
                mcqs: mcqs,
                duration: (parseInt(document.getElementById('studyHr').value)*60) + parseInt(document.getElementById('studyMin').value)
            });
            localStorage.setItem(prefix+'LOGS', JSON.stringify(logs));
            location.reload();
        }

        function updateUI() {
            renderData(); renderSWT(); renderGT(); renderMatrix(); updateMedals();
            const now = new Date();
            const dates = { iniJuly: new Date("2026-05-17"), upsc: new Date("2026-08-02"), neet: new Date("2026-08-30"), iniJan: new Date("2026-11-01") };
            Object.keys(dates).forEach(k => {
                const d = Math.ceil((dates[k] - now)/(1000*60*60*24));
                document.getElementById('days' + k.charAt(0).toUpperCase() + k.slice(1)).innerText = d > 0 ? d : "LIVE";
            });
        }

        function updateMedals() {
            const icons = ["ðŸ¥‰", "ðŸ¥ˆ", "ðŸ¥‡", "ðŸ†"];
            let html = '';
            PHASES.forEach((p, i) => {
                const completed = SUBJECTS.every(s => localStorage.getItem(prefix+p+s) === 'true');
                if(completed) html += icons[i];
            });
            document.getElementById('medals').innerHTML = html;
        }

        function renderMatrix() {
            const logs = JSON.parse(localStorage.getItem(prefix+'LOGS') || "[]");
            let html = `<tr><th>Subject</th><th>1st</th><th>2nd</th><th>3rd</th><th>Ex</th></tr>`;
            let totals = [0, 0, 0, 0];
            SUBJECTS.forEach(s => {
                html += `<tr><td>${s.substring(0,5)}</td>`;
                PHASES.forEach((p, pi) => {
                    const days = new Set(logs.filter(l => l.subject === s && l.phase === p).map(l => l.date)).size;
                    html += `<td>${days}</td>`;
                    totals[pi] += days;
                });
                html += `</tr>`;
            });
            html += `<tr style="background:var(--accent)"><td>TOTAL</td><td>${totals[0]}</td><td>${totals[1]}</td><td>${totals[2]}</td><td>${totals[3]}</td></tr>`;
            document.getElementById('matrixTable').innerHTML = html;
        }

        function calcSWT() {
            const t = parseInt(document.getElementById('swtTotal').value) || 0;
            const c = parseInt(document.getElementById('swtCorrect').value) || 0;
            const u = parseInt(document.getElementById('swtUnat').value) || 0;
            const w = Math.max(0, t - c - u);
            document.getElementById('swtW').innerText = w;
            document.getElementById('swtP').innerText = t > 0 ? ((c/t)*100).toFixed(1) + "%" : "0%";
        }

        function calcGT() {
            const c = parseInt(document.getElementById('gtCorrect').value) || 0;
            const u = parseInt(document.getElementById('gtUnat').value) || 0;
            const w = Math.max(0, 200 - c - u);
            const score = (currentGTMode === 'NEET') ? (c * 4 - w) : (c - (w * 0.33));
            document.getElementById('gtW').innerText = w;
            document.getElementById('gtS').innerText = score.toFixed(2);
        }

        function saveSWT() {
            const d = document.getElementById('swtDate').value;
            const t = parseInt(document.getElementById('swtTotal').value);
            if(!d || isNaN(t)) return;
            const res = JSON.parse(localStorage.getItem(prefix+'SWT') || "[]");
            res.push({ date: d, subject: document.getElementById('swtSubject').value, percent: document.getElementById('swtP').innerText });
            localStorage.setItem(prefix+'SWT', JSON.stringify(res)); updateUI();
        }

        function saveGT() {
            const d = document.getElementById('gtDate').value;
            if(!d) return;
            const key = currentGTMode === 'NEET' ? prefix+'NEET' : prefix+'INI';
            const res = JSON.parse(localStorage.getItem(key) || "[]");
            res.push({ date: d, score: document.getElementById('gtS').innerText });
            localStorage.setItem(key, JSON.stringify(res)); updateUI();
        }

        let charts = {};
        function renderData() {
            const logs = JSON.parse(localStorage.getItem(prefix+'LOGS') || "[]");
            const dates = [...new Set(logs.map(l => l.date))].reverse().slice(-7);
            const hours = dates.map(d => logs.filter(l => l.date === d).reduce((a, b) => a + b.duration/60, 0));
            
            if(charts.h) charts.h.destroy();
            charts.h = new Chart(document.getElementById('hoursChart'), {
                type: 'line', data: { labels: dates, datasets: [{ label: 'Hours', data: hours, borderColor: '#f39c12' }] },
                options: { maintainAspectRatio: false }
            });
            
            let logHtml = '';
            logs.slice(0, 10).forEach(l => {
                logHtml += `<tr><td>${l.date}</td><td>${(l.duration/60).toFixed(1)}</td><td>${l.mcqs}</td><td>${l.subject}</td></tr>`;
            });
            document.getElementById('dailyLogBody').innerHTML = logHtml;
        }

        function renderSWT() { /* Chart Logic */ }
        function renderGT() { /* Chart Logic */ }
        function switchGT(m) { 
            currentGTMode = m; 
            document.getElementById('tabNeet').classList.toggle('active', m === 'NEET');
            document.getElementById('tabInicet').classList.toggle('active', m === 'INICET');
            document.getElementById('neet-area').style.display = m === 'NEET' ? 'block' : 'none';
            document.getElementById('inicet-area').style.display = m === 'INICET' ? 'block' : 'none';
            calcGT();
        }

        window.onload = () => {
            document.getElementById('uFullName').innerText = tgUser.first_name;
            document.getElementById('uID').innerText = `ID: ${tgUser.id}`;
            const t = JSON.parse(localStorage.getItem(prefix+'TARGETS')||"[]");
            document.querySelectorAll('#targetList input').forEach(i => if(t.includes(i.value)) i.checked = true);
            
            let phHtml = '';
            PHASES.forEach(p => {
                let d = JSON.parse(localStorage.getItem(prefix+p)||'{}');
                phHtml += `<div style="font-size:10px; margin-bottom:5px;">${p}<br><input type="date" value="${d.from||''}" onchange="savePh('${p}','from',this.value)"> to <input type="date" value="${d.to||''}" onchange="savePh('${p}','to',this.value)"></div>`;
            });
            document.getElementById('phaseInputs').innerHTML = phHtml;

            let subHtml = '';
            PHASES.forEach(p => {
                SUBJECTS.forEach(s => {
                    let c = localStorage.getItem(prefix+p+s)==='true'?'checked':'';
                    subHtml += `<div><input type="checkbox" ${c} onchange="togSub('${p}','${s}',this.checked)"> ${s.substring(0,3)}</div>`;
                });
            });
            document.getElementById('subjectChecks').innerHTML = subHtml;
            updateUI();
        };

        function clearData() { if(confirm("Clear All Data?")) { localStorage.clear(); location.reload(); } }
    </script>
</body>
</html>

