<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Scalpel Study Squad Diary</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #0e1621; --card: #17212b; --text: #ffffff; --border: #2b5278; --accent: #5288c1; --input-bg: #0e1621; }
        .light-mode { --bg: #f0f2f5; --card: #ffffff; --text: #1c1e21; --border: #ccd0d5; --accent: #2481cc; --input-bg: #f5f7f9; }
        html, body { height: 100%; margin: 0; padding: 0; background: var(--bg); color: var(--text); overflow-x: hidden; transition: background 0.3s ease; }
        body { display: flex; flex-direction: column; align-items: center; justify-content: flex-start; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 20px; box-sizing: border-box; }
        .container { width: 100%; max-width: 420px; display: flex; flex-direction: column; align-items: center; text-align: center; margin: 0 auto; }
        @media (orientation: landscape) { body { padding-top: 20px; } .container { max-width: 500px; } }
        .header-ui { width: 100%; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .theme-switch { font-size: 20px; cursor: pointer; background: var(--card); border: 1px solid var(--border); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; }
        .user-badge { background: rgba(82, 136, 193, 0.2); border: 1px solid var(--accent); padding: 6px 12px; border-radius: 20px; font-size: 12px; color: var(--accent); font-weight: bold; }
        .nav-tabs { display: flex; width: 100%; background: var(--card); border-radius: 15px; margin-bottom: 20px; border: 1px solid var(--border); overflow: hidden; }
        .tab-btn { flex: 1; padding: 12px 5px; font-size: 11px; font-weight: bold; cursor: pointer; border: none; background: none; color: var(--text); opacity: 0.6; border-right: 1px solid var(--border); }
        .tab-btn:last-child { border-right: none; }
        .tab-btn.active { opacity: 1; background: var(--accent); color: white; }
        .logo { width: 100px; height: 100px; border-radius: 50%; border: 4px solid var(--accent); margin-bottom: 10px; box-shadow: 0 0 20px rgba(82,136,193,0.3); }
        h1 { color: var(--accent); font-size: 24px; margin: 5px 0; font-weight: bold; text-transform: uppercase; }
        .quote { font-family: 'Oswald', sans-serif; color: #ef5350; font-weight: 700; font-size: 12px; text-transform: uppercase; margin-top: 5px; }
        .card { background: var(--card); padding: 20px; border-radius: 20px; border: 1px solid var(--border); width: 100%; box-sizing: border-box; margin-bottom: 20px; display: none; }
        .card.active-content { display: block; }
        .setting-label { font-size: 10px; color: #888; text-transform: uppercase; margin: 8px 0 4px 0; display: block; font-weight: bold; text-align: left; }
        input, select { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid var(--border); background: var(--input-bg); color: var(--text); text-align: center; font-size: 14px; box-sizing: border-box; margin-top: 5px; }
        .btn { background: #2481cc; color: white; border: none; padding: 15px; border-radius: 12px; font-weight: bold; width: 100%; cursor: pointer; font-size: 15px; margin-top: 10px; }
        .chart-container { width: 100%; height: 160px; margin: 15px 0; }
        .calc-box { background: var(--input-bg); margin-top: 10px; padding: 10px; border-radius: 10px; border: 1px dashed var(--border); font-size: 12px; display: flex; justify-content: space-around; flex-wrap: wrap; gap: 5px; }
        .gt-tab-btn { flex: 1; padding: 10px; background: var(--input-bg); border: 1px solid var(--border); color: var(--text); font-weight: bold; cursor: pointer; font-size: 11px; }
        .gt-tab-btn.active { background: var(--accent); color: white; }
    </style>
</head>
<body>
    <div id="popup-overlay"></div>

    <div class="container">
        <div class="header-ui">
            <div class="theme-switch" id="themeBtn" onclick="toggleTheme()">ðŸŒ™</div>
            <div class="user-badge" id="uName">@User</div>
        </div>

        <img src="https://github.com/dhruvathaare/Scaslpel-Study-Squad-Apps/blob/main/photo_2026-02-12_20-08-36.jpg?raw=true" class="logo">
        <h1>Scalpel Study Squad</h1>
        <div class="quote">"I AM HERE TO WIN, CONSISTENCY IS MY KITH AND KIN"</div>

        <div class="nav-tabs">
            <div class="tab-btn active" onclick="showTab('study', this)">Study Tracker</div>
            <div class="tab-btn" onclick="showTab('swt', this)">SWT Analysis</div>
            <div class="tab-btn" onclick="showTab('gt', this)">GT Analysis</div>
        </div>

        <div id="tab-study" class="card active-content">
            <div class="streak-text" id="streakText" style="color:#f39c12; font-weight:bold;">Consistency: 0 Days Logged</div>
            <div id="streakIcons"></div>
            <select id="subject" style="margin-top:15px;"><option value="" disabled selected>Select Subject</option><option>Anatomy</option><option>Physiology</option><option>Biochemistry</option><option>Pathology</option><option>Microbiology</option><option>Pharmacology</option><option>FMT</option><option>PSM</option><option>Ophthalmology</option><option>ENT</option><option>Medicine</option><option>Surgery</option><option>OBG</option><option>Pediatrics</option><option>Anaesthesia</option><option>Dermatology</option><option>Orthopedics</option><option>Psychiatry</option><option>Radiology</option><option>Mixed Bag</option><option>Integrated Systems</option></select>
            <div id="timer-display" style="font-size:48px; font-weight:bold; margin:15px 0;">00:00</div>
            <button id="startBtn" class="btn">Start Session</button>
            <button id="stopBtn" class="btn" style="background:#ef5350; display:none;">Stop</button>
            <div class="chart-container"><canvas id="hoursChart"></canvas></div>
        </div>

        <div id="tab-swt" class="card">
            <h3 style="margin:0; color:var(--accent);">Subject-Wise Tests</h3>
            <select id="swtSubject" onchange="renderSWT()"><option>Anatomy</option><option>Physiology</option><option>Biochemistry</option><option>Pathology</option><option>Microbiology</option><option>Pharmacology</option><option>FMT</option><option>PSM</option><option>Ophthalmology</option><option>ENT</option><option>Medicine</option><option>Surgery</option><option>OBG</option><option>Pediatrics</option><option>Anaesthesia</option><option>Dermatology</option><option>Orthopedics</option><option>Psychiatry</option><option>Radiology</option><option>Mixed Bag</option><option>Integrated Systems</option></select>
            <input type="date" id="swtDate" style="margin-top:10px;">
            <div style="display:flex; gap:5px;"><input type="number" id="swtTotal" placeholder="Total Qs" oninput="autoCalcSWT()"><input type="number" id="swtCorrect" placeholder="Correct" oninput="autoCalcSWT()"></div>
            <input type="number" id="swtUnattempted" placeholder="Unattempted" oninput="autoCalcSWT()" style="margin-top:5px;">
            <div class="calc-box"><span>Wrong: <b id="dispSwtWrong">0</b></span><span>Accuracy: <b id="dispSwtPercent" style="color:#2ecc71;">0%</b></span></div>
            <button class="btn" onclick="saveSWT()" style="background:var(--accent);">Save Test</button>
            <div class="chart-container"><canvas id="swtChart"></canvas></div>
            <div id="swtAnalysis" style="font-size:11px; text-align:left;"></div>
        </div>

        <div id="tab-gt" class="card">
            <h3 style="color:#2ecc71; margin-bottom:10px;">GT Intelligence</h3>
            <div style="display:flex; margin-bottom:10px;"><div class="gt-tab-btn active" id="tabNeet" onclick="switchGT('NEET')">NEET (800)</div><div class="gt-tab-btn" id="tabInicet" onclick="switchGT('INICET')">INICET (200)</div></div>
            <input type="date" id="gtDate">
            <div style="display:flex; gap:5px; margin-top:5px;"><input type="number" id="gtCorrect" placeholder="Correct" oninput="autoCalcGT()"><input type="number" id="gtUnattempted" placeholder="Unattempted" oninput="autoCalcGT()"></div>
            <div class="calc-box"><span>Wrong: <b id="dispGtWrong">0</b></span><span>Estimated Score: <b id="dispGtScore" style="color:#2ecc71;">0</b></span></div>
            <button class="btn" onclick="saveGT()" style="background:#2ecc71;">Record Result</button>
            <div class="chart-container"><canvas id="gtChart"></canvas></div>
            <div id="gtAnalysis" style="font-size:11px; text-align:left;"></div>
        </div>

        <button class="btn" onclick="clearHistory()" style="background:transparent; border:1px solid #ef5350; color:#ef5350; font-size:10px; width:auto; margin-bottom:50px;">Clear All Data</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp; tg.ready(); tg.expand();
        const LOG_KEY = 's_logs_v11', NEET_KEY = 's_gt_neet_v11', INI_KEY = 's_gt_ini_v11', SWT_KEY = 's_swt_v11';
        let currentGTMode = "NEET", timerInterval, activeSub = "", alarmInterval = null;

        function autoCalcSWT() {
            const t = parseInt(document.getElementById('swtTotal').value) || 0, c = parseInt(document.getElementById('swtCorrect').value) || 0, u = parseInt(document.getElementById('swtUnattempted').value) || 0;
            document.getElementById('dispSwtWrong').innerText = Math.max(0, t - c - u);
            document.getElementById('dispSwtPercent').innerText = t > 0 ? ((c / t) * 100).toFixed(1) + "%" : "0%";
        }

        function autoCalcGT() {
            const c = parseInt(document.getElementById('gtCorrect').value) || 0, u = parseInt(document.getElementById('gtUnattempted').value) || 0;
            const w = Math.max(0, 200 - c - u);
            const score = (currentGTMode === 'NEET') ? (c * 4 - w * 1) : (c * 1 - w * 0.33);
            document.getElementById('dispGtWrong').innerText = w;
            document.getElementById('dispGtScore').innerText = score.toFixed(currentGTMode==='NEET'?0:2);
        }

        function setMaxDate() {
            const ist = new Date(new Date().getTime() + (330 + new Date().getTimezoneOffset()) * 60000).toISOString().split('T')[0];
            document.querySelectorAll('input[type="date"]').forEach(i => i.max = ist);
        }

        function toggleTheme() {
            const isLight = document.body.classList.toggle('light-mode');
            document.getElementById('themeBtn').innerText = isLight ? 'â˜€ï¸' : 'ðŸŒ™';
            localStorage.setItem('scalpel_theme', isLight ? 'light' : 'dark');
            updateUI();
        }
        if(localStorage.getItem('scalpel_theme') === 'light') toggleTheme();

        function showTab(id, btn) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.card').forEach(c => c.classList.remove('active-content'));
            btn.classList.add('active'); document.getElementById('tab-' + id).classList.add('active-content');
            updateUI();
        }

        function switchGT(m) { 
            currentGTMode = m; 
            document.getElementById('tabNeet').classList.toggle('active', m==='NEET'); 
            document.getElementById('tabInicet').classList.toggle('active', m==='INICET'); 
            autoCalcGT(); renderGT(); 
        }

        function saveSWT() {
            const d = document.getElementById('swtDate').value, t = parseInt(document.getElementById('swtTotal').value), c = parseInt(document.getElementById('swtCorrect').value), u = parseInt(document.getElementById('swtUnattempted').value), sub = document.getElementById('swtSubject').value;
            if(!d || isNaN(t) || (c+u) > t) return;
            const swts = JSON.parse(localStorage.getItem(SWT_KEY) || "[]");
            swts.push({ date: d, total: t, correct: c, unattempted: u, wrong: (t-c-u), subject: sub, percent: ((c/t)*100).toFixed(1) });
            swts.sort((a,b) => new Date(a.date) - new Date(b.date));
            localStorage.setItem(SWT_KEY, JSON.stringify(swts)); updateUI();
        }

        function saveGT() {
            const d = document.getElementById('gtDate').value, c = parseInt(document.getElementById('gtCorrect').value), u = parseInt(document.getElementById('gtUnattempted').value);
            if(!d || (c+u) > 200) return;
            const w = 200 - c - u;
            const s = (currentGTMode === 'NEET') ? (c * 4 - w) : (c - w * 0.33);
            const key = (currentGTMode === 'NEET') ? NEET_KEY : INI_KEY;
            const data = JSON.parse(localStorage.getItem(key) || "[]");
            data.push({ date: d, score: parseFloat(s.toFixed(2)), correct: c, unattempted: u, wrong: w });
            data.sort((a,b) => new Date(a.date) - new Date(b.date));
            localStorage.setItem(key, JSON.stringify(data)); updateUI();
        }

        function updateUI() { setMaxDate(); renderData(); renderGT(); renderSWT(); updateConsistency(); }
        
        let hChart, gChart, sChart;
        function getChartColor() { return document.body.classList.contains('light-mode') ? '#1c1e21' : '#ffffff'; }

        function renderData() {
            const logs = JSON.parse(localStorage.getItem(LOG_KEY) || "[]");
            const grouped = {}; logs.forEach(l => { if (!grouped[l.date]) grouped[l.date] = 0; grouped[l.date] += l.duration/60; });
            const labels = Object.keys(grouped).reverse().slice(-7);
            if(hChart) hChart.destroy();
            hChart = new Chart(document.getElementById('hoursChart'), { type: 'line', data: { labels, datasets: [{ label: 'Study Hours', data: labels.map(l => grouped[l]), borderColor: '#f39c12', tension: 0.3 }] }, options: { maintainAspectRatio: false, scales: { x: { ticks: { color: getChartColor() } }, y: { ticks: { color: getChartColor() } } } }});
        }

        function renderSWT() {
            const sub = document.getElementById('swtSubject').value;
            const swts = JSON.parse(localStorage.getItem(SWT_KEY) || "[]").filter(x => x.subject === sub);
            if(sChart) sChart.destroy();
            if(swts.length === 0) { document.getElementById('swtAnalysis').innerHTML = "No data."; return; }
            sChart = new Chart(document.getElementById('swtChart'), { type: 'line', data: { labels: swts.map(x => x.date), datasets: [{ label: sub + ' (%)', data: swts.map(x => x.percent), borderColor: '#5288c1', tension: 0.3 }] }, options: { maintainAspectRatio: false, scales: { y: { min: 0, max: 100, ticks: { color: getChartColor() } }, x: { ticks: { color: getChartColor() } } } }});
            document.getElementById('swtAnalysis').innerHTML = swts.map(x => `â€¢ ${x.date}: <b>${x.percent}%</b> (C:${x.correct} I:${x.wrong} U:${x.unattempted})`).reverse().join('<br>');
        }

        function renderGT() {
            const data = JSON.parse(localStorage.getItem(currentGTMode==='NEET'?NEET_KEY:INI_KEY) || "[]");
            if(gChart) gChart.destroy();
            if(data.length === 0) { document.getElementById('gtAnalysis').innerHTML = "No data."; return; }
            gChart = new Chart(document.getElementById('gtChart'), { type: 'line', data: { labels: data.map(x => x.date), datasets: [{ label: currentGTMode + ' Score', data: data.map(x => x.score), borderColor: '#2ecc71', tension: 0.3 }] }, options: { maintainAspectRatio: false, scales: { x: { ticks: { color: getChartColor() } }, y: { ticks: { color: getChartColor() } } } }});
            document.getElementById('gtAnalysis').innerHTML = data.map(x => `â€¢ ${x.date}: <b>Score:${x.score}</b> (C:${x.correct} I:${x.wrong} U:${x.unattempted})`).reverse().join('<br>');
        }

        function updateConsistency() {
            const logs = JSON.parse(localStorage.getItem(LOG_KEY) || "[]");
            const unique = new Set(logs.map(l => l.date)).size;
            document.getElementById('streakText').innerText = `Consistency: ${unique} Days Logged`;
        }

        function clearHistory() { if(confirm("Erase all data?")) { localStorage.clear(); location.reload(); }}
        updateUI();
    </script>
</body>
</html>

