<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Scalpel Study Squad Diary</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.1.0"></script>
    <style>
        /* Core Centering Logic */
        html, body { height: 100%; margin: 0; padding: 0; background: #0e1621; overflow-x: hidden; }
        body { display: flex; flex-direction: column; align-items: center; justify-content: flex-start; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; color: white; padding: 20px; box-sizing: border-box; }
        .container { width: 100%; max-width: 420px; display: flex; flex-direction: column; align-items: center; text-align: center; margin: 0 auto; }
        @media (orientation: landscape) { body { padding-top: 40px; } .container { max-width: 500px; } }
        .header-ui { width: 100%; display: flex; justify-content: flex-end; margin-bottom: 10px; }
        .user-badge { background: rgba(82, 136, 193, 0.2); border: 1px solid #5288c1; padding: 6px 12px; border-radius: 20px; font-size: 12px; color: #5288c1; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 5px; }
        .logo { width: 110px; height: 110px; border-radius: 50%; border: 4px solid #5288c1; margin-bottom: 10px; box-shadow: 0 0 20px rgba(82,136,193,0.3); }
        h1 { color: #5288c1; font-size: 24px; margin: 5px 0; font-weight: bold; text-transform: uppercase; }
        .streak-text { font-size: 16px; font-weight: bold; color: #f39c12; }
        .quote { font-family: 'Oswald', sans-serif; color: #ef5350; font-weight: 700; font-size: 12px; text-transform: uppercase; margin-top: 5px; }
        .sub-title { font-size: 10px; color: #888; margin-bottom: 15px; text-transform: uppercase; font-weight: bold; }
        .countdown-box { width: 100%; background: #17212b; padding: 12px; border-radius: 15px; border: 1px solid #2b5278; margin-bottom: 20px; box-sizing: border-box; }
        .count-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #2b5278; font-size: 13px; }
        .count-item:last-child { border-bottom: none; }
        .days-left { font-weight: bold; color: #f39c12; }
        .card { background: #17212b; padding: 20px; border-radius: 20px; border: 1px solid #2b5278; width: 100%; box-sizing: border-box; margin-bottom: 20px; }
        .setting-label { font-size: 10px; color: #888; text-transform: uppercase; margin: 8px 0 4px 0; display: block; font-weight: bold; text-align: left; }
        input, select { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #2b5278; background: #0e1621; color: white; text-align: center; font-size: 14px; box-sizing: border-box; margin-top: 5px; }
        input[type="date"] { color-scheme: dark; }
        #timer-display { font-size: 48px; font-weight: bold; margin: 10px 0; color: #fff; }
        .btn { background: #2481cc; color: white; border: none; padding: 15px; border-radius: 12px; font-weight: bold; width: 100%; cursor: pointer; font-size: 15px; margin-top: 10px; }
        .chart-container { width: 100%; height: 180px; margin: 15px 0; position: relative; }
        .gt-tab-btn { flex: 1; padding: 10px; background: #0e1621; border: 1px solid #2b5278; color: #888; font-weight: bold; cursor: pointer; font-size: 12px; }
        .gt-tab-btn.active { background: #2b5278; color: white; border-color: #5288c1; }
        .calc-preview { background: rgba(82, 136, 193, 0.1); padding: 10px; border-radius: 10px; margin-top: 10px; font-size: 12px; border: 1px dashed #5288c1; display: flex; justify-content: space-around; }
        #popup-overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:1000; justify-content:center; align-items:center; }
    </style>
</head>
<body>
    <div id="popup-overlay"><div style="background:#17212b; padding:25px; border-radius:20px; border:1px solid #5288c1; width:80%; max-width:300px; text-align:center;"><h3>Session Complete!</h3><p>Log MCQs?</p><div style="display:flex; gap:10px; margin-top:20px;"><button style="flex:1; padding:12px; background:#2ecc71; color:white; border:none; border-radius:10px;" onclick="handleMcqResponse(true)">YES</button><button style="flex:1; padding:12px; background:#ef5350; color:white; border:none; border-radius:10px;" onclick="handleMcqResponse(false)">NO</button></div></div></div>

    <div class="container">
        <div class="header-ui"><div class="user-badge" id="uName">üë§ @User</div></div>
        <img src="https://github.com/dhruvathaare/Scaslpel-Study-Squad-Apps/blob/main/photo_2026-02-12_20-08-36.jpg?raw=true" class="logo">
        <h1>Scalpel Study Squad</h1>
        <div class="streak-section">
            <div class="streak-text" id="streakText">Consistency: 0 Days Logged</div>
            <div id="streakIcons" style="font-size:18px; margin:5px 0;"></div>
            <div class="quote">"I AM HERE TO WIN, CONSISTENCY IS MY KITH AND KIN"</div>
        </div>

        <div class="countdown-box">
            <div class="count-item"><span>INICET July 2026</span><span class="days-left" id="d1">--</span></div>
            <div class="count-item"><span>UPSC CMS 2026</span><span class="days-left" id="d2">--</span></div>
            <div class="count-item"><span>NEET PG 2026</span><span class="days-left" id="d3">--</span></div>
            <div class="count-item"><span>INICET Jan 2027</span><span class="days-left" id="d4">--</span></div>
        </div>

        <div class="card">
            <span class="setting-label">Reading Stage</span>
            <select id="readingStage"><option>First Reading üìì</option><option>Second Reading üßëüèª‚Äçüíª</option><option>Third Reading üíØ</option><option>Extra Bonus üî•</option></select>
            <span class="setting-label">Subject</span>
            <select id="subject"><option value="" disabled selected>Select Subject</option><option>Anatomy</option><option>Physiology</option><option>Biochemistry</option><option>Pathology</option><option>Microbiology</option><option>Pharmacology</option><option>FMT</option><option>PSM</option><option>Ophthalmology</option><option>ENT</option><option>Medicine</option><option>Surgery</option><option>OBG</option><option>Pediatrics</option><option>Anaesthesia</option><option>Dermatology</option><option>Orthopedics</option><option>Psychiatry</option><option>Radiology</option><option>Mixed Bag</option><option>Integrated Systems</option></select>
            <div style="display:flex; gap:10px;"><div style="flex:1;"><span class="setting-label">Study (M)</span><input type="number" id="studyTime" value="120"></div><div style="flex:1;"><span class="setting-label">Break (M)</span><input type="number" id="breakTime" value="15"></div></div>
            <div id="timer-display">00:00</div>
            <button id="startBtn" class="btn">Start Session</button>
            <button id="stopBtn" class="btn" style="background:#ef5350; display:none;">Stop & Record</button>
        </div>

        <div class="card">
            <h3 style="margin:0; color:#f39c12;">Daily Analytics</h3>
            <div class="chart-container"><canvas id="hoursChart"></canvas></div>
            <div class="chart-container"><canvas id="mcqChart"></canvas></div>
        </div>

        <div class="card">
            <h3 style="margin:0; color:#5288c1;">Subject-Wise Tests</h3>
            <span class="setting-label">Subject & Date</span>
            <select id="swtSubject" onchange="renderSWT()"><option>Anatomy</option><option>Physiology</option><option>Biochemistry</option><option>Pathology</option><option>Microbiology</option><option>Pharmacology</option><option>FMT</option><option>PSM</option><option>Ophthalmology</option><option>ENT</option><option>Medicine</option><option>Surgery</option><option>OBG</option><option>Pediatrics</option><option>Anaesthesia</option><option>Dermatology</option><option>Orthopedics</option><option>Psychiatry</option><option>Radiology</option><option>Mixed Bag</option><option>Integrated Systems</option></select>
            <input type="date" id="swtDate">
            <div style="display:flex; gap:5px; margin-top:5px;"><input type="number" id="swtTotal" placeholder="Total Qs" oninput="calcSWT()"><input type="number" id="swtCorrect" placeholder="Correct" oninput="calcSWT()"></div>
            <input type="number" id="swtUnattempted" placeholder="Unattempted" oninput="calcSWT()" style="margin-top:5px;">
            <div class="calc-preview"><span>Wrong: <b id="swtW">0</b></span><span>Accuracy: <b id="swtP">0%</b></span></div>
            <button class="btn" onclick="saveSWT()" style="background:#5288c1;">Save SWT</button>
            <div class="chart-container"><canvas id="swtChart"></canvas></div>
            <div id="swtAnalysis" style="font-size:11px; text-align:left; color:#5288c1; line-height:1.5;"></div>
        </div>

        <div class="card">
            <h3 style="margin-bottom:15px; color:#2ecc71;">GT Intelligence</h3>
            <div style="display:flex; margin-bottom:15px;"><div class="gt-tab-btn active" id="tabNeet" onclick="switchGT('NEET')">NEET (800)</div><div class="gt-tab-btn" id="tabInicet" onclick="switchGT('INICET')">INICET (200)</div></div>
            <input type="text" id="gtPlatform" placeholder="Platform">
            <input type="date" id="gtDate" style="margin-top:5px;">
            <div style="display:flex; gap:5px; margin-top:5px;"><input type="number" id="gtCorrect" placeholder="Correct" oninput="calcGT()"><input type="number" id="gtUnattempted" placeholder="Unattempted" oninput="calcGT()"></div>
            <div class="calc-preview"><span>Wrong: <b id="gtW">0</b></span><span>Score: <b id="gtS">0</b></span></div>
            <button class="btn" onclick="saveGT()" style="background:#2ecc71;">Record GT</button>
            <div class="chart-container"><canvas id="gtChart"></canvas></div>
            <div id="gtAnalysis" style="font-size:11px; text-align:left; color:#f39c12; line-height:1.5;"></div>
        </div>

        <button class="btn" onclick="clearHistory()" style="background:transparent; border:1px solid #ef5350; color:#ef5350; font-size:10px; width:auto; margin-bottom:50px;">Clear History</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp; tg.ready(); tg.expand();
        const LOG_KEY = 's_logs_v13', NEET_KEY = 's_gt_neet_v13', INI_KEY = 's_gt_ini_v13', SWT_KEY = 's_swt_v13';
        let currentGTMode = "NEET", timerInterval, activeSub = "", wakeLock = null;

        const requestWakeLock = async () => { try { if ('wakeLock' in navigator) wakeLock = await navigator.wakeLock.request('screen'); } catch (err) {} };
        const releaseWakeLock = () => { if (wakeLock) { wakeLock.release(); wakeLock = null; } };

        function updateUI() {
            const ist = new Date(new Date().getTime() + 330 * 60 * 1000).toISOString().split('T')[0];
            document.getElementById('swtDate').max = ist; document.getElementById('gtDate').max = ist;
            const exams = [{id:'d1',d:"May 16, 2026"},{id:'d2',d:"July 12, 2026"},{id:'d3',d:"August 30, 2026"},{id:'d4',d:"November 15, 2026"}];
            exams.forEach(ex => { const diff = Math.ceil((new Date(ex.d) - new Date()) / 86400000); document.getElementById(ex.id).innerText = diff > 0 ? diff + "d" : "Exam!"; });
            renderData(); renderGT(); renderSWT(); updateConsistency();
        }

        function calcSWT() {
            const t = parseInt(document.getElementById('swtTotal').value) || 0, c = parseInt(document.getElementById('swtCorrect').value) || 0, u = parseInt(document.getElementById('swtUnattempted').value) || 0;
            document.getElementById('swtW').innerText = Math.max(0, t - c - u);
            document.getElementById('swtP').innerText = t > 0 ? ((c / t) * 100).toFixed(1) + "%" : "0%";
        }

        function calcGT() {
            const c = parseInt(document.getElementById('gtCorrect').value) || 0, u = parseInt(document.getElementById('gtUnattempted').value) || 0;
            const w = Math.max(0, 200 - c - u);
            const s = (currentGTMode === 'NEET') ? (c * 4 - w) : (c - (w * 0.333));
            document.getElementById('gtW').innerText = w; document.getElementById('gtS').innerText = s.toFixed(currentGTMode === 'NEET' ? 0 : 2);
        }

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playBeep(f, d) { const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.connect(g); g.connect(audioCtx.destination); o.frequency.value = f; g.gain.value = 0.1; o.start(); setTimeout(() => o.stop(), d); }
        let alarmInterval = null;
        function startAlarm(f) { stopAlarm(); alarmInterval = setInterval(() => playBeep(f, 200), 1000); }
        function stopAlarm() { if(alarmInterval) { clearInterval(alarmInterval); alarmInterval = null; } }

        if (tg.initDataUnsafe?.user) document.getElementById('uName').innerText = tg.initDataUnsafe.user.username ? `@${tg.initDataUnsafe.user.username}` : tg.initDataUnsafe.user.first_name;

        const startBtn = document.getElementById('startBtn'), stopBtn = document.getElementById('stopBtn'), display = document.getElementById('timer-display');
        startBtn.onclick = () => { if (!document.getElementById('subject').value) return tg.showAlert("Select Subject!"); audioCtx.resume(); requestWakeLock(); activeSub = document.getElementById('subject').value; let tL = parseInt(document.getElementById('studyTime').value) * 60;
            clearInterval(timerInterval); startBtn.style.display = 'none'; stopBtn.style.display = 'block';
            timerInterval = setInterval(() => { tL--; let m = Math.floor(tL / 60), s = tL % 60; display.innerText = `${m}:${s < 10 ? '0' : ''}${s}`; if (tL <= 0) handleTransition(); }, 1000);
        };
        function handleTransition() { clearInterval(timerInterval); startAlarm(880); document.getElementById('popup-overlay').style.display = 'flex'; }
        stopBtn.onclick = () => handleTransition();
        function handleMcqResponse(y) { stopAlarm(); document.getElementById('popup-overlay').style.display = 'none'; let m = y ? (parseInt(prompt("MCQs?")) || 0) : 0;
            const logs = JSON.parse(localStorage.getItem(LOG_KEY) || "[]"); logs.unshift({ date: new Date().toLocaleDateString('en-GB'), subject: activeSub, mcqs: m, duration: parseInt(document.getElementById('studyTime').value) });
            localStorage.setItem(LOG_KEY, JSON.stringify(logs)); display.innerText = "00:00"; startBtn.style.display = 'block'; stopBtn.style.display = 'none'; releaseWakeLock(); updateUI(); }

        function saveSWT() {
            const d = document.getElementById('swtDate').value, t = parseInt(document.getElementById('swtTotal').value), c = parseInt(document.getElementById('swtCorrect').value), u = parseInt(document.getElementById('swtUnattempted').value), sub = document.getElementById('swtSubject').value;
            if(!d || isNaN(t) || (c+u) > t) return;
            const data = JSON.parse(localStorage.getItem(SWT_KEY) || "[]"); data.push({ date: d, total: t, correct: c, unattempted: u, wrong: (t-c-u), subject: sub, percent: ((c/t)*100).toFixed(1) });
            data.sort((a,b) => new Date(a.date) - new Date(b.date)); localStorage.setItem(SWT_KEY, JSON.stringify(data)); updateUI();
        }
        function saveGT() {
            const d = document.getElementById('gtDate').value, c = parseInt(document.getElementById('gtCorrect').value), u = parseInt(document.getElementById('gtUnattempted').value), p = document.getElementById('gtPlatform').value;
            if(!d || (c+u) > 200) return;
            const w = 200 - c - u; const s = (currentGTMode === 'NEET') ? (c * 4 - w) : (c - (w * 0.333));
            const data = JSON.parse(localStorage.getItem(currentGTMode === 'NEET' ? NEET_KEY : INI_KEY) || "[]");
            data.push({ date: d, score: parseFloat(s.toFixed(2)), correct: c, unattempted: u, wrong: w, platform: p || "Manual" });
            data.sort((a,b) => new Date(a.date) - new Date(b.date)); localStorage.setItem(currentGTMode === 'NEET' ? NEET_KEY : INI_KEY, JSON.stringify(data)); updateUI();
        }

        let hChart, mChart, gChart, sChart;
        function renderData() {
            const logs = JSON.parse(localStorage.getItem(LOG_KEY) || "[]");
            const grouped = {}; logs.forEach(l => { if (!grouped[l.date]) grouped[l.date] = {h:0, m:0}; grouped[l.date].h += l.duration/60; grouped[l.date].m += l.mcqs; });
            const labels = Object.keys(grouped).reverse().slice(-7);
            const hours = labels.map(l => grouped[l].h); const mcqs = labels.map(l => grouped[l].m);
            const avgH = hours.length ? (hours.reduce((a,b)=>a+b,0)/hours.length).toFixed(1) : 0;
            const avgM = mcqs.length ? Math.round(mcqs.reduce((a,b)=>a+b,0)/mcqs.length) : 0;

            if(hChart) hChart.destroy(); hChart = new Chart(document.getElementById('hoursChart'), { type: 'line', data: { labels, datasets: [{ label: 'Hours', data: hours, borderColor: '#f39c12', tension: 0.3 }] }, options: { maintainAspectRatio: false, scales: { x:{ticks:{color:'#fff'}}, y:{ticks:{color:'#fff', callback:v=>v+'hr'}}}, plugins: { annotation: { annotations: { line1: { type:'line', yMin:avgH, yMax:avgH, borderColor:'rgba(243, 156, 18, 0.4)', borderDash:[5,5], label: { display:true, content:'Avg: '+avgH+'h', position:'end', backgroundColor:'transparent', color:'rgba(255,255,255,0.6)', font:{size:10} } }}}}}});
            if(mChart) mChart.destroy(); mChart = new Chart(document.getElementById('mcqChart'), { type: 'line', data: { labels, datasets: [{ label: 'MCQs', data: mcqs, borderColor: '#5288c1', tension: 0.3 }] }, options: { maintainAspectRatio: false, scales: { x:{ticks:{color:'#fff'}}, y:{ticks:{color:'#fff', stepSize:1, callback:v=>Math.floor(v)===v?v:''}}}, plugins: { annotation: { annotations: { line1: { type:'line', yMin:avgM, yMax:avgM, borderColor:'rgba(82, 136, 193, 0.4)', borderDash:[5,5], label: { display:true, content:'Avg: '+avgM, position:'end', backgroundColor:'transparent', color:'rgba(255,255,255,0.6)', font:{size:10} } }}}}}});
        }

        function renderSWT() {
            const sub = document.getElementById('swtSubject').value; const swts = JSON.parse(localStorage.getItem(SWT_KEY) || "[]").filter(x => x.subject === sub);
            if(sChart) sChart.destroy(); if(swts.length === 0) return;
            sChart = new Chart(document.getElementById('swtChart'), { type: 'line', data: { labels: swts.map(x => x.date), datasets: [{ label: sub + ' (%)', data: swts.map(x => x.percent), borderColor: '#5288c1', backgroundColor: 'rgba(82,136,193,0.1)', fill: true, tension: 0.3 }] }, options: { maintainAspectRatio: false, scales: { y:{min:0, max:100, ticks:{color:'#fff'}}, x:{ticks:{color:'#fff'}}}}});
            document.getElementById('swtAnalysis').innerHTML = swts.map(x => `‚Ä¢ ${x.date}: <b>${x.percent}%</b> (C:${x.correct} I:${x.wrong} U:${x.unattempted})`).reverse().join('<br>');
        }
        function renderGT() {
            const data = JSON.parse(localStorage.getItem(currentGTMode === 'NEET' ? NEET_KEY : INI_KEY) || "[]");
            if(gChart) gChart.destroy(); if(data.length === 0) return;
            gChart = new Chart(document.getElementById('gtChart'), { type: 'line', data: { labels: data.map(x => x.date), datasets: [{ label: currentGTMode + ' Score', data: data.map(x => x.score), borderColor: '#2ecc71', tension: 0.3 }] }, options: { maintainAspectRatio: false, scales: { x:{ticks:{color:'#fff'}}, y:{ticks:{color:'#fff'}}}}});
            document.getElementById('gtAnalysis').innerHTML = data.map(x => `‚Ä¢ ${x.date} [${x.platform}]: <b>Score:${x.score}</b> (C:${x.correct} I:${x.wrong} U:${x.unattempted})`).reverse().join('<br>');
        }
        function switchGT(m) { currentGTMode = m; document.getElementById('tabNeet').className = m==='NEET'?'gt-tab-btn active':'gt-tab-btn'; document.getElementById('tabInicet').className = m==='INICET'?'gt-tab-btn active':'gt-tab-btn'; calcGT(); renderGT(); }
        function updateConsistency() { const logs = JSON.parse(localStorage.getItem(LOG_KEY) || "[]"); document.getElementById('streakText').innerText = `Consistency: ${new Set(logs.map(l => l.date)).size} Days Logged`; }
        function clearHistory() { if(confirm("Erase all data?")) { localStorage.clear(); location.reload(); }}
        updateUI();
    </script>
</body>
</html>

